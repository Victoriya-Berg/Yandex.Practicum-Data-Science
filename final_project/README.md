# Прогнозирование оттока клиентов

Оператор связи «Ниединогоразрыва.ком» хочет научиться прогнозировать отток клиентов. Если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и договорах.

**Цель**: модель должна предсказывать, уйдет ли клиент или останется. В случае возможного ухода клиента, предложить особые условия обслуживания, которые позволит сохранить его (клиента) и сэкономить на привлечении нового клиента. В качестве основной метрики выбран ROC-AUC, оценка которой в идеале должна быть выше 0.85. На создание прототипа модели отведено 4 дня. Еще 4 дня на подготовку отчета.

**План работы:**
1. Изучить данные и сделать предобработку
    * Разобраться с пустыми строками
    * Соединить таблицы (можно после анализа данных)
2. Провести исследовательский анализ данных
3. Подобрать 3 модели (возможны изменения) и выбрать лучшую:
    * Логистическая регрессия
    * Метод случайного леса
    * KNN-метод
4. Сделать отчет по проведенной работе

# Отчет
Были выполнены практически все пункты плана, в том числе была добавлена еще модель для исследования: CatBoostClassifier. К сожалению, в задуманные сроки не удалось уложиться, т.к. возникали ошибки по ходу написания кода, которые надо было исправлять (об этом ниже).

Главная трудность возникала при написании модели CatBoostClassifier, где не получилось подать "грязные" данные на вход из-за `ValueError isChurn is not in List`. Через несколько попыток исправлений решила это обойти с помощью закодированных данных.

Ключевые шаги в работе:
* Изучить таблицы с данными по отдельности
* Поменять типы данных и разобраться с пропусками
* Выделить таргет и создать синтетический признак
* Соединить таблицы
* Провести исследовательский анализ данных
* Провести анализ влияния факторов через аналитический метод (VIF)
* Поиск наилучшей модели
* Тестирование лучшей модели

**Как проходила предобработка данных?**
1. Вывела все таблицы и изучила их структуру
2. Перевела строки с датами в тип данных `datetime`, чтобы можно было с ними работать как с числами
3. При попытке изменении типа данных в колонке общего дохода от клиента, было обнаружено, что датасет собран на момент 2020-02-01
4. В следствие этого пропуски в колонке общего дохода от клиента были заполнены нулями, т.к. клиент не успел еще внести "тотал"
5. Далее создала синтетический признак на основе двух имеющихся: дата начала договора и дата его окончания. Сделано это для выведени "лояльности" клиента. Ведь чем дольше он с компанией, тем меньше шансов его ухода.
6. Соединила таблицы.
7. Пропуски в новом датафрейме заполнила `No`, т.к. отсутствие ID клиента в той или иной таблице подразумевает отсутствие и самой услуги у клиента.
8. Удалила признаки с датами для избежание утечки данных (особенно дата окончания договора).
9. Провела проверку на мультиколлинеарность с помощью VIF, в результате которого было удалено два признака. Данная проверка проводилась для работы с линейными моделями и избежания сильных зависимостей.
10. Кодировала категориальные признаки сочетая два способа: OneHotEncoding и LabelEncoding (в ретроспективе понимаю, что для некоторых признаков надо было сделать OHE, а не LabelEncoding, например в колонке `Gender`)

Для обучения модели использовалась часть старых признаков и два новых. Удалены временные признаки, т.к. это не анализ временных рядов и можно получить утечку данных. Добавлен таргет из даты окончания договора - ушел клиент или нет? И добавлено кол-во дней активного договора из обеих дат (начала и окончания договора), показывающий лояльность клиента.
